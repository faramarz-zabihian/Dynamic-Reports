var oIndex;(()=>{"use strict";var e={81:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.FSP=void 0,function(e){var t,r;!function(e){e[e.report=0]="report",e[e.page=1]="page",e[e.group=2]="group"}(t=e.AggregatePosition||(e.AggregatePosition={})),function(e){e[e.sum=0]="sum",e[e.avg=1]="avg",e[e.count=2]="count",e[e.max=3]="max",e[e.min=4]="min"}(r=e.AggregateOp||(e.AggregateOp={}));var n=function(){function t(e){this.name="",this.templateID=null,this.columns=[],this.orderby=[],this.groupby=[],this.filters=[],this.aggregates=[],this.parameters=[],this.templateID=e}return t.prototype.deleteAggregate=function(e){e>=0&&e<=this.aggregates.length&&this.aggregates.splice(e,1)},t.prototype.deleteGroup=function(e){var t=this.getGroupIndex(e);t<0||this.columnIndex(e)<0||this.groupby.splice(t,1)},t.prototype.rearrangeOrders=function(){for(var e=0;e<this.groupby.length;e++){var t=this.groupby[e].name,r=this.getOrderIndex(t);this.rePosition(this.orderby,r,e)}},t.prototype.addGroup=function(e,t,r){var n=this.column(e);if(null!=n){(r<0||null==r)&&(r=this.groupby.length);var o=this.getGroupIndex(n.name);return o>-1?this.rePosition(this.groupby,o,r):this.groupby.splice(r,0,new p(this,this.column(e).name,t)),this.getOrderIndex(n.name)<0&&this.addOrder(e),this.rearrangeOrders(),this.rearrangeColumns(),r}},t.prototype.column=function(e){return e<0||e>=this.columns.length?null:this.columns[e]},t.prototype.columnIndex=function(e){for(var t=0;t<this.columns.length;t++)if(this.columns[t].name==e)return t;return-1},t.prototype.getColumnByName=function(e){for(var t=0;t<this.columns.length;t++)if(this.columns[t].name==e)return this.columns[t];return null},t.prototype.getOrderIndex=function(e){for(var t=0;t<this.orderby.length;t++)if(this.orderby[t].name==e)return t;return-1},t.prototype.getGroupIndex=function(e){var t=this.columnIndex(e);if(t<0)return t;for(var r=0;r<this.groupby.length;r++)if(this.groupby[r].name==e)return r;return-1},t.prototype.getTypeCol=function(e){for(var t=0;t<=this.columns.length;t++)if(this.columns[t].name==e)return this.columns[t].type},t.prototype.save=function(t,r){var n=e.service.BackendCall("SaveReport",{r:this,name:t,genAccess:r});return window.JSON.parse(n)},t.prototype.drop=function(){e.service.BackendCall("DropReport",{templateID:this.templateID,name:this.name})},t.prototype.execute=function(t,r,n,o){o(window.JSON.parse(e.service.GetPageData({r:this,templateID:this.templateID,FromPage:t,ToPage:r,PageSize:n})),window.JSON.parse(e.service.GetTranslator({r:this,templateID:this.templateID})))},t.prototype.deleteParameter=function(e){for(var t=this.parameters.length-1;t>=0;t--)if(this.parameters[t].name===e){this.parameters.splice(t,1);break}},t.prototype.addColumnByTemplate=function(e,t){return this.addColumn(e.name,e.title,e.type,e.width,t)},t.prototype.addColumn=function(e,t,r,n,i){var s=this.columnIndex(e);return s>-1?s:((null==i||i<0||i>this.columns.length)&&(i=this.columns.length),this.columns.splice(i,0,new o(this,e,null==t?e:t,r)),i)},t.prototype.deleteColumn=function(e){this.deleteOrder(e),this.deleteFilter(e);var t=this.columnIndex(e);t<0||(this.columns.splice(t,1),this.mergeIndex>=t&&(this.mergeIndex=this.mergeIndex),this.mergeIndex>=t&&--this.mergeIndex)},t.prototype.addOrder=function(e,t){var r=this.column(e);if(null==r)return-1;var n=this.getOrderIndex(r.name);return n>-1?null!=t&&this.rePosition(this.orderby,n,t):((t=null!=t?t:this.orderby.length)<0&&(t=this.orderby.length),this.orderby.splice(t,0,new l(this,this.column(e).name,!1))),this.rearrangeGroups(),this.rearrangeColumns(),this.rearrangeOrders(),t},t.prototype.rearrangeGroups=function(){for(var e=0,t=0;t<this.orderby.length;t++){var r=this.getGroupIndex(this.orderby[t].name);r>-1&&this.rePosition(this.groupby,r,e++)}},t.prototype.rePosition=function(e,t,r){if(!(t<0||r<0||t>=e.length||r>=e.length)&&t!=r){var n=e[t];e.splice(t,1),e.splice(r,0,n)}},t.prototype.rearrangeColumns=function(){for(var e=0;e<this.groupby.length;e++){var t=this.groupby[e].name,r=this.columnIndex(t);this.rePosition(this.columns,r,e)}},t.prototype.deleteOrder=function(e){var t=this.getOrderIndex(e);t>=0&&(this.deleteGroup(this.orderby[t].name),this.orderby.splice(t,1))},t.prototype.addParamater=function(e,t){for(var r=!1,n=0;n<this.parameters.length;n++)this.parameters[n].name==e.name&&(r=!0);return!r&&(this.parameters.push(e),!0)},t.prototype.addFilter=function(e,t,r,n,o,s){var a=this.column(e);if(null!=a)return-1!=s&&null!=s||(s=this.filters.length),this.filters.splice(s,0,new i(this,a.name,n,t,r,o)),s},t.prototype.deleteFilter=function(e){for(var t=this.filters.length-1;t>=0;t--)if(this.filters[t].colName===e){this.filters.splice(t,1);break}},t.prototype.deleteFilterByRowIndex=function(e){e>-1&&e<this.filters.length&&this.filters.splice(e,1)},t.prototype.addAggregate=function(e,t,n){var o;void 0===t&&(t=r.sum);var i=null===(o=this.column(e))||void 0===o?void 0:o.name;this.aggregates.push(new s(this,t,n,i))},t.prototype.copy=function(e){this.name="",this.title="",this.subTitle="",this.printRowNo=!1,this.printUnderLine=!1,this.printDate=!1,this.fontFace="tahoma",this.fontSize=1,this.pageCount=-1,this.pageSize=-1,this.mergeIndex=-1,this.columns=[],this.orderby=[],this.groupby=[],this.filters=[],this.aggregates=[],this.parameters=[];var t=function(e,t){for(var r in e)if(t.hasOwnProperty(r)){var n=Object.prototype.toString.call(t[r]);"[object Object]"!==n&&"[object Array]"!==n&&(e[r]=t[r])}return e},r=function(e,r,n){for(var o in e)r.push(t(new n,e[o]))};null!=e&&null!=e&&(t(this,e),r(e.columns,this.columns,o),r(e.orderby,this.orderby,l),r(e.groupby,this.groupby,p),r(e.aggregates,this.aggregates,s),r(e.filters,this.filters,i),r(e.parameters,this.parameters,u))},t}();e.Report=n;var o=function(e,t,r,n,o){this.name=t,this.title=r,this.report=e,this.type=n,this.width=o};e.Column=o;var i=function(){function e(e,t,r,n,o,i){void 0===r&&(r="<="),void 0===i&&(i=!1),this.report=e,this.colName=t,this.operand1=n,this.operand2=o,this.operator=r,this.negate=i}return e.prototype.getDescription=function(){var e=function(e){return null==e||null==e?"":"´"+e+"`"},t="«"+this.report.getColumnByName(this.colName).title+"»"+function(e){switch(e){case"<":return" کوچکتر از ";case"<=":return" کوچکتر یا برابر با ";case">":return" بزرگتر از ";case">=":return" بزرگتر یا برابر با ";case"=":return" برابر با ";case"~":return" دربردارنده ";case"()":return" بین ";case"(,)":return" در فهرست ";case"(":return" مانند ";case")":return" مانند";case"n":return" خالی ";default:return""}}(this.operator);return"()"==this.operator?t+=e(this.operand1+" و "+this.operand2):t+=e(this.operand1),t+(this.negate?" نباشد.":" باشد.")},e.prototype.init=function(){"Number"==this.type?(this.operator="=",this.operand1="0"):"DateTime"==this.type?(this.operator="<=",this.operand1="..."):(this.operator="n",this.negate=!0)},e}();e.Filter=i;var s=function(){function e(e,r,n,o){this.position=t.report,this.report=e,this.colName=o,this.setType(r),this.setPosition(n)}return e.prototype.setType=function(e){var t=this.report.columnIndex(this.colName);t>-1?(this.report.column(t),this.type=r.count):r.count},e.prototype.setPosition=function(e){this.report.columnIndex(this.colName)>-1&&this.report.getGroupIndex(this.colName)>=0&&(this.position=e),e!=t.group&&(this.position=e)},e}();e.Aggregate=s;var a=function(e,t,r){this.inputType=e,this.prompt=t,this.lookupReport=r};e.ParamValue=a;var u=function(){this.value=new a("dataEntry","وارد  کنید",null)};e.Parameter=u;var l=function(){function e(e,t,r){this.report=e,this.name=t,this.descending=!1}return e.prototype.getColumn=function(){return this.report.getColumnByName(this.name)},e.prototype.getDes=function(){return"«"+this.getColumn().title+"»"+function(e){switch(e){case void 0:case"":case!1:return" صعودی است ";case!0:return" نزولی است ";default:return""}}(this.descending)},e}();e.Order=l;var p=function(){function e(e,t,r){this.report=e,this.name=t}return e.prototype.getColumn=function(){return this.report.getColumnByName(this.name)},e}();e.Group=p,e.service={setBase:function(e){this.baseURL=e},getAddress:function(e){return this.baseURL+"/"+e},getColumns:function(e){var t=this.BackendCall(this.getAddress("getColumns"),{templateID:e});return window.JSON.parse(t)},list:function(e){var t=this.BackendCall(this.getAddress("ListReport"),{templateID:e});return JSON.parse(t)},load:function(e,t){var r=this.BackendCall(this.getAddress("LoadReport"),{templateID:e,name:t});return window.JSON.parse(r)},listTemplates:function(){return window.JSON.parse(this.BackendCall(this.getAddress("listTemplates")))},GetPageData:function(e){return this.BackendCall(this.getAddress("PageData"),e)},GetTranslator:function(e){return this.BackendCall(this.getAddress("XSLTranslator"),e)},JSupport:function(){return"Microsoft Internet Explorer"!=navigator.appName},BackendCall:function(e,t){if(this.JSupport())return this.JCall(e,t,!1);this.XCall(e,t)},XCall:function(e,t){var r;(r=window.ActiveXObject?new ActiveXObject("Msxml2.XMLHTTP"):new XMLHttpRequest).open("POST",e,!1);try{r.responseType="document"}catch(e){}return r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(JSON.stringify(t)),r},JCall:function(e,t,r,n,o){null==n&&(n=function(e){}),null==o&&(o=function(e){alert("failure :::"+e.responseText)}),null==r&&(r=!0),null==t&&(t=null);var i=[];return $.ajax({type:"POST",url:e,data:JSON.stringify(t,(function(e,t){if("object"==typeof t&&null!==t){if(-1!==i.indexOf(t))return;i.push(t)}return t})),contentType:"application/json; charset=utf-8",dataType:"json",success:n,error:o,async:r}).responseText},JDownLoad:function(e,t,r){var n=new XMLHttpRequest;n.open("POST",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200===this.status){var e="",t=n.getResponseHeader("Content-Disposition");if(t&&-1!==t.indexOf("attachment")){var r=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(t);null!=r&&r[1]&&(e=r[1].replace(/['"]/g,""))}var o=n.getResponseHeader("Content-Type"),i=new Blob([this.response],{type:o});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(i,e);else{var s=window.URL||window.webkitURL,a=s.createObjectURL(i);if(e){var u=document.createElement("a");void 0===u.download?window.location.href=a:(u.href=a,u.download=e,document.body.appendChild(u),u.click())}else window.location.href=a;setTimeout((function(){s.revokeObjectURL(a)}),100)}}},n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(JSON.stringify(t))},decode:function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">")}}}(r||(t.FSP=r={}))}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}var n={};(()=>{var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.downloadPdf=e.downloadDoc=e.download=e.plainReport=e.GroupedReport=e.FilteredReport=e.listTemplates=e.listReports=e.generateSample=e.setServiceURL=void 0;var t=r(81);e.setServiceURL=function(e){t.FSP.service.setBase(e)},e.generateSample=function(e){var r=t.FSP.service.getColumns(e),n=new t.FSP.Report(e);n.name=e;for(var o=0;o<r.length;o++)n.addColumnByTemplate(r[o]);n.execute(1,1,20,i)};var o=function(e,t){$("result").xslt(e,t)};e.listReports=function(e){for(var r=t.FSP.service.list(e),n=0;n<r.length;n++){var i=$("<span/>").val(r[n].title).on("click",(function(i){t.FSP.service.load(e,r[n].title).execute(1,1,30,o)}));$("#reports").append(i).append($("br"))}},e.listTemplates=function(){var e=t.FSP.service.listTemplates();$("#templates").val("German");for(var r=function(r){var n=$("input").attr("type","button").val("create report").on("click",(function(t){return a(e[r].name)})),o=$("span").val(e[r].title).append(n).on("click",(function(n){t.FSP.service.list(e[r].name)}));$("#templates").append(o).append($("<br/>"))},n=0;n<e.length;n++)r(n)};var i=function(e,t){$("#result").xslt(e,t)};function s(e){var r=new t.FSP.Report(e);return r.templateID=e,r.name="test",r.addColumn("Topic","موضوع","str"),r.addColumn("Topic","موضوع","str"),r.addColumn("Desc","شرح","str"),r.addColumn("Date","تاریخ","str"),r}function a(e){s(e).execute(1,1,100,o)}e.FilteredReport=function(e){var t=s(e);t.addGroup(t.columnIndex("Topic")),t.execute(1,1,100,o)},e.GroupedReport=function(e){var t=s(e);t.addGroup(t.columnIndex("Topic")),t.addFilter(t.columnIndex("Topic"),"1393/01/01",null,"<",!1),t.execute(1,1,100,o)},e.plainReport=a,e.download=function(e){null!=e&&t.FSP.service.JDownLoad("GetExcel",{r:e},null)},e.downloadDoc=function(e){null!=e?t.FSP.service.JDownLoad("GetDoc",{r:e},null):alert("execute a report first")},e.downloadPdf=function(e){null!=e?t.FSP.service.JDownLoad("GetPdf",{r:e},null):alert("execute a report first")}})(),oIndex=n})();